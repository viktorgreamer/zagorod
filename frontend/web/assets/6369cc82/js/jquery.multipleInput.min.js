!function(t){t.fn.multipleInput=function(e){return r[e]?r[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist on jQuery.multipleInput"),!1):r.init.apply(this,arguments)};var e={afterInit:"afterInit",beforeAddRow:"beforeAddRow",afterAddRow:"afterAddRow",beforeDeleteRow:"beforeDeleteRow",afterDeleteRow:"afterDeleteRow",afterDropRow:"afterDropRow"},i={id:null,inputId:null,template:null,jsTemplates:[],jsInit:[],max:1,min:1,attributes:{},indexPlaceholder:"multiple_index",showGeneralError:!1},n=!1,r={init:function(r){if("object"!=typeof r)return void console.error("Options must be an object");var u=t.extend(!0,{},i,r||{}),s=t("#"+u.id),d=s.closest("form"),c=u.inputId;for(v in u.jsInit)window.eval(u.jsInit[v]);s.data("multipleInput",{settings:u,currentIndex:0}),s.on("click.multipleInput",".js-input-remove",function(e){e.stopPropagation(),a(t(this))}),s.on("click.multipleInput",".js-input-plus",function(e){e.stopPropagation(),l(t(this))}),s.on("click.multipleInput",".js-input-clone",function(e){e.stopPropagation(),l(t(this),f(t(this)))});var v=0,m=t.Event(e.afterInit),h=setInterval(function(){if("object"==typeof d.data("yiiActiveForm")){var e=d.yiiActiveForm("find",c),i={enableAjaxValidation:!1,validateOnBlur:!1,validateOnChange:!1,validateOnType:!1,validationDelay:500};"object"==typeof e&&(t.each(e,function(t,e){["id","input","container"].indexOf(t)===-1&&(i[t]=e)}),u.showGeneralError||d.yiiActiveForm("remove",c)),t.each(u.attributes,function(e,n){n=t.extend({},i,n),u.attributes[e]=n}),s.data("multipleInput").settings=u,s.find(".multiple-input-list").find("input, select, textarea").each(function(){o(t(this))}),s.data("multipleInput").currentIndex=p(s),n=!0,clearInterval(h),s.trigger(m)}else v++;(0===d.length||v>10)&&(s.data("multipleInput").currentIndex=p(s),n=!1,clearInterval(h),s.trigger(m))},100)},add:function(e){l(t(this),e)},remove:function(e){var i=null;i=void 0!==e?t(this).find(".js-input-remove:eq("+e+")"):t(this).find(".js-input-remove").last(),a(i)},clear:function(){t(".js-input-remove").each(function(){a(t(this))})},option:function(e,i){i=i||null;var n=t(this).data("multipleInput"),r=n.settings;if(null===i){if(!r.hasOwnProperty(e))throw new Error('Option "'+e+'" does not exist');return r[e]}r.hasOwnProperty(e)&&(r[e]=i,n.settings=r,t(this).data("multipleInput",n))}},l=function(i,r){var l=t(i).closest(".multiple-input").first(),a=l.data("multipleInput"),u=a.settings,f=u.template,d=l.children(".multiple-input-list").first();if(!(null!==u.max&&p(l)>=u.max)){f=f.replaceAll("{"+u.indexPlaceholder+"}",a.currentIndex);var c=t(f),v=t.Event(e.beforeAddRow);if(l.trigger(v,[c]),v.result!==!1){if(c.hide().appendTo(d).fadeIn(300),r instanceof Object){var m=[];for(var h in r)r.hasOwnProperty(h)&&m.push(r[h]);r=m}var I;for(var g in u.jsTemplates)I=u.jsTemplates[g].replaceAll("{"+u.indexPlaceholder+"}",a.currentIndex).replaceAll("%7B"+u.indexPlaceholder+"%7D",a.currentIndex),window.eval(I);var w=0;t(f).find("input, select, textarea").each(function(e,i){var l=t(i),a=i.tagName,u=s(l),p=t("#"+u);if(r){var f=r[w];if("INPUT"===a||"TEXTAREA"===a)p.val(f);else if("SELECT"===a)if(f&&f.indexOf("option")!==-1)p.append(f);else{var d=p.find('option[value="'+f+'"]');d.length&&p.val(f)}}n&&o(l),w++}),l.data("multipleInput").currentIndex++;var x=t.Event(e.afterAddRow);l.trigger(x,[c])}}},a=function(i){var r=i.closest(".multiple-input").first(),l=i.closest(".multiple-input-list__item"),a=r.data("multipleInput"),o=a.settings;if(p(r)>o.min){var s=t.Event(e.beforeDeleteRow);if(r.trigger(s,[l]),s.result===!1)return;n&&l.find("input, select, textarea").each(function(e,i){u(t(i))}),l.fadeOut(300,function(){t(this).remove(),s=t.Event(e.afterDeleteRow),r.trigger(s,[l])})}},o=function(e){var i=s(e);if(null!==i){var n=t("#"+i),r=n.closest(".multiple-input").first(),l=n.closest("form");if(0!==r.length&&"undefined"==typeof l.yiiActiveForm("find",i)){var a=r.data("multipleInput"),o={},u=i.replace(/-\d+-([^\d]+)$/,"-$1");a.settings.attributes.hasOwnProperty(u)?o=a.settings.attributes[u]:(u=u.replaceAll(/-\d-/,"-").replaceAll(/-\d/,""),a.settings.attributes.hasOwnProperty(u)&&(o=a.settings.attributes[u])),l.yiiActiveForm("add",t.extend({},o,{id:i,input:"#"+i,container:".field-"+i}))}}},u=function(e){var i=s(e);if(null!==i){var n=t("#"+i).closest("form");0!==n.length&&n.yiiActiveForm("remove",i)}},s=function(t){var e=t.attr("id");return"undefined"==typeof e&&(e=t.data("id")),"undefined"==typeof e?null:e},p=function(e){return e.find(".multiple-input-list .multiple-input-list__item").filter(function(){return t(this).parents(".multiple-input").first().attr("id")===e.attr("id")}).length},f=function(e){var i={};return e.closest("tr").find("td").each(function(e,n){t(n).find("input, select, textarea").each(function(e,n){var r=t(n),l=s(r),a=t("#"+l);i[l]=a.val()})}),i};String.prototype.replaceAll=function(t,e){return this.split(t).join(e)}}(window.jQuery);